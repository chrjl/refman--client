<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="/styles/frames.css">
  <link rel="stylesheet" href="/styles/styles.css">

  <meta property="API_SERVER" value="/api">
  <meta property="ENTRIES_ENDPOINT" value="/entries">
  <meta property="JSON_DUMP_ENDPOINT" value="/entries/DUMP">
  <meta property="METADATA_ENDPOINT" value="/metadata">
  <meta property="ARCHIVE_ENDPOINT" value="/archives/generate">
  <meta property="BIBLATEX_ENDPOINT" value="/archives/generate-biblatex">

  <script>
    const setEnvFromMeta = function () {
      const properties = document.head.querySelectorAll('meta[property]');

      return [...properties].reduce((obj, elem) => ({
        ...obj,
        [elem.getAttribute('property')]: elem.getAttribute('value'),
      }), {});
    };

    window.env = setEnvFromMeta();

    localStorage.setItem('env', JSON.stringify(env));
    localStorage.removeItem('buffer');
  </script>
</head>

<body>
  <h1>welcome</h1>

  <div id="collection" class="widgets-container">
    <iframe id="selector" name="selector" src="/components/frames/selector.html"></iframe>
    <iframe id="visualeditor" name="visualeditor" src="/components/frames/visualeditor.html"></iframe>
    <iframe id="texteditor" name="texteditor" src="/components/frames/texteditor.html"></iframe>
  </div>

  <form id="buttons" class="buttons" style="display:inline-block">
    <fieldset id="server-interface">
      <legend>server</legend>
    </fieldset>

    <fieldset id="storage-interface">
      <legend>application</legend>
    </fieldset>

    <fieldset id="views">
      <legend>views</legend>
    </fieldset>
  </form>
</body>

<script type="module"> // buttons
  import idb from '/scripts/idb.js';
  import ServerAPI from '/components/buttons/server-api.mjs';
  import StorageInterface from '/components/buttons/storage-interface.mjs';
  import Views from '/components/buttons/views.mjs';

  document.getElementById('server-interface')
    .append(new ServerAPI({ endpoint: `${env.API_SERVER}${env.ENTRIES_ENDPOINT}` }));

  document.getElementById('storage-interface')
    .append(new StorageInterface({ endpoint: `${env.API_SERVER}${env.JSON_DUMP_ENDPOINT}` }));

  // reload selector after fetching entries to idb
  document.querySelector('iframe#selector').src += '';

  document.getElementById('views')
    .append(new Views());
</script>

</html>